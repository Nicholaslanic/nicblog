//Booking JS//By Nicholas$(function(){	//座位信息	var seatInfo={		seatAreas:[{		"seatArea":"bg1",		"nameArea":"一区",		"contain":4,		"environ":"靠落地窗,适合情侣,可以观看xx城市夜景",		"url":"xxx1"	   },	   {		"seatArea":"bg2",		"nameArea":"二区",		"contain":4,		"environ":"不靠窗,光线足,安静",		"url":"xxx2"	   },	   {		"seatArea":"bg3",		"nameArea":"三区",		"contain":4,		"environ":"不靠窗,热闹,靠近吧台",		"url":"xxx3"	   }]		}	//初始化	function initBook(){		randomDisable();		renderClass('disable1');	}	initBook();		//模拟随机座位被占用	function randomDisable(){		var arrRan=new Array();		var random=parseInt(Math.random()*10)%6 || 1; //生成0~3个随机数(如果随出0,则=1)		 		for(var i = 0 ; ; i++){ 			// 只生成random个随机数(0~3) 			if(arrRan.length<random){ 				  genRandom(15);			}else{ 			  break; 		   } 		}				//生成随机数的方法(不重复)		function genRandom(modulo){			var rand=parseInt(Math.random()*15)%modulo;			for(var i=0;i<arrRan.length;i++){				if(arrRan[i]==rand){					return false;				}			}			arrRan.push(rand);		}				for(i in arrRan){			$('.unit').eq(arrRan[i]).removeClass('select1').addClass('disable1');		}	}				//渲染class	function renderClass(classname){		//console.log($('.'+classname).children());		if(classname=='disable1'){			$('.'+classname).children().addClass('changeRed').parent().css('cursor','not-allowed');		}		if(classname=='checked1'){			$('.'+classname).children().addClass('changeSelect');		}		if(classname=='unit'){			_that.children().removeClass('changeSelect');		}	}			//选择(单选)	$('.select1').on('click',function(){		var cN=$('.checked1').length;		if(cN==0){			_that=$(this);			_that.addClass('checked1');			renderClass('checked1');			if($('.checked1').length==1){				$('.bookSubmit').animate({'right':'0'},1000);				loadSeatInfo();			}		}		if(cN==1){			_that=$(this);			renderClass('unit');			_that.removeClass('checked1');			if($('.checked1').length==0){				$('.bookSubmit').animate({'right':'-300px'},1000);				loadSeatInfo();			}					}		});		//鼠标移入移出	$('.unit').mouseenter(function(){		$('.seatInformation').show();		$(document).on('mousemove',function(e){			$('.seatInformation').offset({top:e.pageY+10,left:e.pageX+10});		});		var areaClass=$(this).parent()[0].className;		for(var i=0;i<seatInfo.seatAreas.length;i++){				if(seatInfo.seatAreas[i].seatArea==areaClass){				$('.bookInfo2').html("<p>区域:"+seatInfo.seatAreas[i].seatArea+"</p><p>座位人数:"+seatInfo.seatAreas[i].contain+"</p><p>环境:"+seatInfo.seatAreas[i].environ+"</p><p>haha</p>");			}		}	}).mouseleave(function(){		$('.seatInformation').hide();	});			//加载区域数据	function loadSeatInfo(){		var areaClass=_that.parent()[0].className;		for(var i=0;i<seatInfo.seatAreas.length;i++){			if(seatInfo.seatAreas[i].seatArea==areaClass){				$('.bookInfo').html("<img src='http://i4.buimg.com/590781/f331a8ea5da3f8ac.jpg'/><p>区域:"+seatInfo.seatAreas[i].seatArea+"</p><p>座位人数:"+seatInfo.seatAreas[i].contain+"</p><p>环境:"+seatInfo.seatAreas[i].environ+"</p><p>是否确认预定该位置?</p>");			}			}		}		//提交生成订单编号	function createIden(){		var idate=new Date();		var str=''+idate.getTime();  		var myReg=/^\d{5}/;		var user='CNC'+'_';		var newStr=str.replace(myReg,user);		return newStr;	}			//表单提交/取消	$('.cancelBook').on('click',function(){		_that2=$('.Restaurant').find('.checked1');		_that2.children().removeClass('changeSelect');		_that2.removeClass('checked1');		$('.bookSubmit').animate({'right':'-300px'},1000);	});	$('.bookingFin').on('click',function(){		var iText=createIden();		$('.progress-bar').animate({'width':'100%'},1700).text('100%');  		alert('预定成功,您的订单号为:'+iText+' ,谢谢!');	});			//附加选项	var addFlag=false;	$('.addBtn').on('click',function(){		if(!addFlag){			addFlag=!addFlag;			$(this).addClass('btn_active').val('取消预订');			$('.addOption_view').animate({'height':'166px'},1000);		}else if(addFlag){			addFlag=!addFlag;			$(this).removeClass('btn_active');			$('.addOption_view').animate({'height':'0'},1000).find('.div_active').removeClass('div_active').find('.selected1').remove();			$(this).val('附加选项');			$('.selected2').text('');		}	});		//预定名厨	var addKitName='';	$('.addOpt_sec').on('click',function(){		var arrow='<div class="selected1"><img src="http://i4.buimg.com/590781/19bce3141f36bff5.png" alt="" /></div>'		$(this).addClass('div_active').siblings().removeClass('div_active');		$(this).append(arrow).siblings().find('.selected1').remove();		addKitName=$(this).find('.kitchenerName').text();		$('.selected2').text('预订名厨: "'+addKitName+' "');	});		//提交注册	$('.register_button input').on('click',function(){		if(validRegister()){			$('.userName1').text($('.fillIn_user').val()+': ');			$('.register').animate({'top':'20px'},300,function(){				$('.register').animate({'top':'-616px'},1000);			});			$('.progress-bar').animate({'width':'50%'},1500).text('50%'); 			return;			}		alert('信息填写不全,请检查');	});	//提交前:检查资料是否已填写	function validRegister(){		var ur=false,ph=false,em=false,da=false;		if($('.fillIn_user').val())ur=true;   		if($('.fillIn_phone').val()) ph=true; 		if($('.fillIn_email').val()) em=true; 		if($('.bookDate').val()) da=true; 				return ur && ph && em && da;	}		//检验user字符范围(按键按起时触发)	$('.fillIn_user').on('keyup',function(){		if($('.fillIn_user').val().length>=4 && $('.fillIn_user').val().length<=15 ){				$('.userWarn').text('');			}else{				$('.userWarn').text(' 输入的字数请限制在4到15个字符之间!')			}	});		//检验phone字符范围(按下按键)	$('.fillIn_phone').on('keydown',function(e){		var oEvent=e||event;		//console.log(oEvent.keyCode);		if((oEvent.keyCode>=8 && oEvent.keyCode<=9)||(oEvent.keyCode>=48 && oEvent.keyCode<=57)||(oEvent.keyCode>=96 && oEvent.keyCode<=105)|| oEvent.keyCode==16 || oEvent.keyCode==32 || oEvent.keyCode==107 ||oEvent.keyCode==109 || oEvent.keyCode==187 || oEvent.keyCode==229){			$('.phoneWarn').text('');			return true;		}				$('.phoneWarn').text(' 必须大于11位,并且只支持"0-9"数字,"-","+"等符号!');		return false;			});		//检验邮箱	$('.fillIn_email').on('blur',function(){		var myReg= /^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;		 if(!myReg.test($(this).val())){			  $('.emailWarn').text('请输入有效的E_mail！');			  return false;            }		$('.emailWarn').text('');	});});